

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon/warning.png">
  <link rel="icon" href="/img/icon/warning.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="0X00 前言同源策略是前端安全的基石，想学好前端安全的第一步也是最重要的一步就是深入理解同源策略以及和同源策略相关的比如 cors csp jsonp 还有 xss 经常会涉及的 cookie 作用域，以及脚本源的归属问题，原先只是简单的了解，于是打算抽出一点时间再次强化一下对其的理解，以便后期能对前端的安全作出更加深入的分析和探究。 0X01 同源策略为了下面的解释让人更好理解，我想要先解释一">
<meta property="og:type" content="article">
<meta property="og:title" content="浅谈前端“源”相关">
<meta property="og:url" content="http://example.com/2019/02/09/%E6%B5%85%E8%B0%88%E5%89%8D%E7%AB%AF%E2%80%9C%E6%BA%90%E2%80%9D%E7%9B%B8%E5%85%B3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="0X00 前言同源策略是前端安全的基石，想学好前端安全的第一步也是最重要的一步就是深入理解同源策略以及和同源策略相关的比如 cors csp jsonp 还有 xss 经常会涉及的 cookie 作用域，以及脚本源的归属问题，原先只是简单的了解，于是打算抽出一点时间再次强化一下对其的理解，以便后期能对前端的安全作出更加深入的分析和探究。 0X01 同源策略为了下面的解释让人更好理解，我想要先解释一">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A51.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A52.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A53.png">
<meta property="og:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A54.png">
<meta property="article:published_time" content="2019-02-09T01:14:18.000Z">
<meta property="article:modified_time" content="2025-01-24T15:19:22.649Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="前端">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A51.png">
  
  
  
  <title>浅谈前端“源”相关 - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/macpanel.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 60vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>K0rz3n&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/banner/icemountain.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="浅谈前端“源”相关"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2019-02-09 01:14" pubdate>
          February 9, 2019 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.2k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          52 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">浅谈前端“源”相关</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="0X00-前言"><a href="#0X00-前言" class="headerlink" title="0X00 前言"></a><strong>0X00 前言</strong></h2><p>同源策略是前端安全的基石，想学好前端安全的第一步也是最重要的一步就是深入理解同源策略以及和同源策略相关的比如 cors csp jsonp 还有 xss 经常会涉及的 cookie 作用域，以及脚本源的归属问题，原先只是简单的了解，于是打算抽出一点时间再次强化一下对其的理解，以便后期能对前端的安全作出更加深入的分析和探究。</p>
<h2 id="0X01-同源策略"><a href="#0X01-同源策略" class="headerlink" title="0X01 同源策略"></a><strong>0X01 同源策略</strong></h2><p>为了下面的解释让人更好理解，我想要先解释一下同源策略</p>
<h3 id="1-什么叫同源"><a href="#1-什么叫同源" class="headerlink" title="1.什么叫同源"></a><strong>1.什么叫同源</strong></h3><p>同源，就是协议、域名、端口号相同的URL，但凡这里面有一个不一样，我们就认为是不同源</p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A51.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<p>下面我们来举一个实际的例子帮助我们理解一下</p>
<span id="more"></span>

<p>以<a target="_blank" rel="noopener" href="http://abc.com/%E4%B8%BA%E4%BE%8B">http://abc.com/为例</a></p>
<table>
<thead>
<tr>
<th>url</th>
<th align="center">是否同源</th>
<th align="center">原因</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="http://abc.com/other">http://abc.com/other</a></td>
<td align="center">是</td>
<td align="center">协议、端口、域名相同</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://abc.com/">https://abc.com</a></td>
<td align="center">否</td>
<td align="center">协议不同(https)</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://abc.com:81/">http://abc.com:81</a></td>
<td align="center">否</td>
<td align="center">端口不同（81）</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.abc.com/">http://www.abc.com/</a></td>
<td align="center">否</td>
<td align="center">域名不同，顶级域名与www子域名不是一个概念</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://news.abc.com/">http://news.abc.com/</a></td>
<td align="center">否</td>
<td align="center">域名不同（news)</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>注意：</strong></p>
<p>这里比较容易混淆的就是 abc.com  和 <a target="_blank" rel="noopener" href="http://www.abc.com/">www.abc.com</a> ，我们常常把 www作为主域名，但是实际上是不规范的，www其实也只是 abc.com 的一个子域名而已。</p>
</blockquote>
<h3 id="2-同源策略-Same-Origin-Policy-SOP"><a href="#2-同源策略-Same-Origin-Policy-SOP" class="headerlink" title="2.同源策略  Same-Origin-Policy(SOP)"></a><strong>2.同源策略  Same-Origin-Policy(SOP)</strong></h3><p>浏览器采用同源策略，<strong>在没有明确授权的情况下</strong>，禁止页面加载或执行与自身不同源的任何脚本。</p>
<blockquote>
<p>**注意：**这里说的明确授权指的是下面会讲到的 cors jsonp 等合理跨域方式</p>
</blockquote>
<h4 id="1-同源策略又分为以下两种："><a href="#1-同源策略又分为以下两种：" class="headerlink" title="(1)同源策略又分为以下两种："></a><strong>(1)同源策略又分为以下两种：</strong></h4><p>**1.DOM 同源策略：**禁止对不同源页面 DOM 进行操作。这里主要场景是 iframe 跨域的情况，不同域名的 iframe 是限制互相访问的(比如一个恶意网站的页面通过iframe嵌入了银行的登录页面（二者不同源），如果没有同源限制，恶意网页上的javascript脚本就可以在用户登录银行的时候获取用户名和密码)<br>**2.XMLHttpRequest 同源策略：**禁止使用 XHR 对象向不同源的服务器地址发起 HTTP 请求(这一点里面其实包括了 ajax)。</p>
<h4 id="2-但是同源策略留了一些“后门”"><a href="#2-但是同源策略留了一些“后门”" class="headerlink" title="(2)但是同源策略留了一些“后门”"></a><strong>(2)但是同源策略留了一些“后门”</strong></h4><p>1.页面中的链接，重定向以及表单提交是不会受到同源策略限制的(<strong>未授权情况下，ajax 的表单提交是不被允许的,但是普通的表单是可以直接跨域的</strong>)。<br>2.<code>&lt;script&gt;、&lt;img&gt;、&lt;iframe&gt;、&lt;link&gt;</code>这些包含 src 属性的标签可以加载跨域资源。但浏览器限制了JavaScript的权限使其不能读、写加载的内容。</p>
<h3 id="3-为什么要有同源策略"><a href="#3-为什么要有同源策略" class="headerlink" title="3.为什么要有同源策略"></a><strong>3.为什么要有同源策略</strong></h3><p>很明显，我们是为了解决浏览器浏览中的一些安全问题才出现的同源策略，举一下两个例子</p>
<p><strong>(1)如果没有 DOM 同源策略，也就是说不同域的 iframe 之间可以相互访问，那么黑客可以这样进行攻击：</strong></p>
<p>1.做一个假网站，里面用 iframe 嵌套一个银行网站 <a target="_blank" rel="noopener" href="http://mybank.com./">http://mybank.com。</a><br>2.把 iframe 宽高啥的调整到页面全部，这样用户进来除了域名，别的部分和银行的网站没有任何差别。<br>3.这时如果用户输入账号密码，我们的主网站可以跨域访问到 <a target="_blank" rel="noopener" href="http://mybank.com/">http://mybank.com</a> 的 dom 节点，就可以拿到用户的账户密码了。</p>
<p><strong>(2)如果 XMLHttpRequest 同源策略，那么黑客可以进行 CSRF（跨站请求伪造） 攻击：</strong></p>
<p>1.用户登录了自己的银行页面 <a target="_blank" rel="noopener" href="http://mybank.com,http//mybank.com">http://mybank.com，http://mybank.com</a> 向用户的 cookie 中添加用户标识。<br>2.用户浏览了恶意页面 <a target="_blank" rel="noopener" href="http://evil.com,执行了页面中的恶意/">http://evil.com，执行了页面中的恶意</a> AJAX 请求代码。<br>3.<a target="_blank" rel="noopener" href="http://evil.com/">http://evil.com</a> 向 <a target="_blank" rel="noopener" href="http://mybank.com/">http://mybank.com</a> 发起 AJAX HTTP 请求，<strong>浏览器会默认把 <a target="_blank" rel="noopener" href="http://mybank.com/">http://mybank.com</a> 对应 cookie 也同时发送过去</strong>。<br>4.银行页面从发送的 cookie 中提取用户标识，验证用户无误，response中返回请求数据。此时数据就泄露了，而且由于 Ajax 在后台执行，用户无法感知这一过程。</p>
<blockquote>
<p><strong>注意：</strong> </p>
<p>cookie 是浏览器根据你请求的页面进行发送的，而与从哪个页面发送过去请求无关。比如说，我访问了 a.com 以后获取了 a.com 的cookie ，然后我访问 q.com ，由于 cookie 域的限制，浏览器在请求 q.com 的时候不会携带 a.com 的cookie ，但是当 q.com 有一个向 a.com 发起的请求的时候，浏览器就会自动的在这个请求中带上 a.com 的 cookie。</p>
</blockquote>
<h3 id="4-关于同源的一些小结"><a href="#4-关于同源的一些小结" class="headerlink" title="4.关于同源的一些小结"></a><strong>4.关于同源的一些小结</strong></h3><p><strong>(1)跨域读：</strong> 同源策略是不允许这种事情发生的，如果可以你就能使用 js  读取嵌入在 iframe 中的页面的 dom 元素，获取敏感信息了 </p>
<p>**(2)跨域写：**同源策略不阻止这种操作，比如向不同源的地址发送 POST 请求等，但是这种允许只限制在普通表单（而且是在没有 CSRF token 或者验证 referer 的情况下），对于 ajax 这种方式也是默认不允许的，如果随随便便允许就会出现使用  ajax 来进行 CSRF 请求的情况了</p>
<p>**(3)跨域嵌入：**这种方式是默认允许的，我们可以在一个源中通过 iframe 嵌入 另一个源的页面，但是如果想限制这种操作的话，我们可以设置 x-frame-options  这个头，这样设置了这个头的页面就允许被嵌入到不同源的页面中了</p>
<h2 id="0X02-跨域的方法"><a href="#0X02-跨域的方法" class="headerlink" title="0X02 跨域的方法"></a><strong>0X02 跨域的方法</strong></h2><p>我们知道同源策略的出现是为了保证浏览器浏览的安全性，但是在实际的开发中，我们有些时候必须要对不同源的资源进行访问(比如说使用 ajax 进行跨域的表单提交，再比如说前端开发人员需要调用后端开发人员提供的 api 接口获取数据等)，毕竟安全性也不能干扰正常的网站的开发工作，于是在基于同源策略的情况下一些跨域的方式出现了，最主要的方式就是 CORS 和 JSONP </p>
<h3 id="1-CORS（跨域资源共享）"><a href="#1-CORS（跨域资源共享）" class="headerlink" title="1.CORS（跨域资源共享）"></a><strong>1.CORS（跨域资源共享）</strong></h3><p>跨域资源共享(CORS) 是一种机制，它使用额外的 HTTP 头来告诉浏览器  让运行在一个 origin (domain) 上的Web应用被准许访问来自不同源服务器上的指定的资源。</p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A52.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<p>实现 CORS 通信的关键是服务器。只要服务器实现了 CORS 接口，就可以跨源通信。<br>浏览器将CORS请求分成两类：<strong>简单请求（simple request）<strong>和</strong>非简单请求（not-so-simple request）</strong></p>
<p>只要同时满足以下两大条件，就属于简单请求。</p>
<p><strong>1.请求方法是以下三种方法之一：</strong></p>
<pre><code class="hljs">HEAD
GET
POST
</code></pre>
<p><strong>2.HTTP的头信息不超出以下几种字段：</strong></p>
<pre><code class="hljs">Accept
Accept-Language
Content-Language
Last-Event-ID
Content-Type：只限于三个值 application/x-www-form-urlencoded、multipart/form-data、text/plain
</code></pre>
<p>凡是不同时满足上面两个条件，就属于非简单请求(最常见的就是 ajax 发送 json 数据)。</p>
<p><strong>浏览器对这两种请求的处理方式是不一样的</strong></p>
<h4 id="1-简单请求"><a href="#1-简单请求" class="headerlink" title="(1)简单请求"></a><strong>(1)简单请求</strong></h4><p>1.在请求中需要附加一个额外的 Origin 头部，其中包含请求页面的源信息（协议、域名和端口），以便服务器根据这个头部信息来决定给予何种响应。例如：Origin: <a target="_blank" rel="noopener" href="http://www.k0rz3n.com/">http://www.K0rz3n.com</a></p>
<p>2.如果服务器认为这个请求可以接受，就在 Access-Control-Allow-Origin头部中回发相同的源信息（如果是公共资源，可以回发 * ）。例如：Access-Control-Allow-Origin：<a target="_blank" rel="noopener" href="http://www.k0rz3n.com/">http://www.K0rz3n.com</a></p>
<p>3.没有这个头部或者有这个头部但源信息不匹配，浏览器就会驳回这个响应。正常情况下，浏览器会处理该响应。</p>
<p><strong>例如 localhost:63343 通过Ajax请求<a href="http://192.168.10.61:8080服务器资源时就会出现如下异常：">http://192.168.10.61:8080服务器资源时就会出现如下异常：</a></strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A53.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<blockquote>
<p><strong>注意:</strong></p>
<p>请求和响应都不包含 cookie 信息。如果需要包含 cookie 信息，ajax 请求需要设置 xhr 的属性withCredentials 为 true，服务器需要设置响应头部 Access-Control-Allow-Credentials:true。</p>
</blockquote>
<h4 id="2-非简单请求"><a href="#2-非简单请求" class="headerlink" title="(2)非简单请求"></a><strong>(2)非简单请求</strong></h4><p>浏览器在发送真正的请求之前，会先发送一个 Preflight 请求给服务器，这种请求使用 OPTIONS 方法，发送下列头部：</p>
<pre><code class="hljs">Origin：与简单的请求相同。
Access-Control-Request-Method: 请求自身使用的方法。
Access-Control-Request-Headers: （可选）自定义的头部信息，多个头部以逗号分隔。
</code></pre>
<p><strong>例如：</strong></p>
<pre><code class="hljs">OPTIONS /someData/ HTTP/1.1
Host: public-data.com
......
Origin: http://ambergarden.com
Access-Control-Request-Method: POST
Access-Control-Request-Headers: X-CUSTOM-HEADER
</code></pre>
<p>发送这个请求后，服务器可以决定是否允许这种类型的请求。服务器通过在响应中发送如下头部与浏览器进行沟通：</p>
<pre><code class="hljs">Access-Control-Allow-Origin：与简单的请求相同。
Access-Control-Allow-Methods: 允许的方法，多个方法以逗号分隔。
Access-Control-Allow-Headers: 允许的头部，多个方法以逗号分隔。
Access-Control-Max-Age: 应该将这个 Preflight 请求缓存多长时间（以秒表示）。
</code></pre>
<p><strong>例如：</strong></p>
<pre><code class="hljs">HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://K0rz3n.com
Access-Control-Allow-Methods: POST, GET, OPTIONS
Access-Control-Allow-Headers: X-CUSTOM_HEADER
Access-Control-Max-Age: 1728000
......
</code></pre>
<p>一旦服务器通过 Preflight 请求允许该请求之后，以后每次浏览器正常的 CORS请求，就都跟简单请求一样了。</p>
<p><strong>请求：</strong></p>
<pre><code class="hljs">POST /someData/ HTTP/1.1
Host: public-data.com
X-CUSTOM-HEADER: custom_header_value
......

[Payload Here]
</code></pre>
<p><strong>响应：</strong></p>
<pre><code class="hljs">HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://K0rz3n.com
Content-Type: application/xml
......

[Payload Here]
</code></pre>
<h4 id="3-优缺点对比"><a href="#3-优缺点对比" class="headerlink" title="(3)优缺点对比"></a><strong>(3)优缺点对比</strong></h4><h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a><strong>优点</strong></h5><p>1.CORS 通信与同源的 AJAX 通信没有差别，代码完全一样，容易维护。<br>2.支持所有类型的 HTTP 请求。</p>
<h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a><strong>缺点</strong></h5><p>1.存在兼容性问题，特别是 IE10 以下的浏览器。<br>2.第一次发送非简单请求时会多一次请求。</p>
<h3 id="2-JSONP-JSON-with-Padding"><a href="#2-JSONP-JSON-with-Padding" class="headerlink" title="2.JSONP(JSON with Padding)"></a><strong>2.JSONP(JSON with Padding)</strong></h3><p>由于 script 标签不受浏览器同源策略的影响，允许跨域引用资源。因此可以通过动态创建 script标签，然后利用 src 属性进行跨域，这也就是 JSONP 跨域的基本原理,jsonp 可以说是 json 的一种使用模式，其实 jsonp 我在之前的文章中也介绍过了 <a target="_blank" rel="noopener" href="http://www.k0rz3n.com/2018/06/05/%E7%94%B1%E6%B5%85%E5%85%A5%E6%B7%B1%E7%90%86%E8%A7%A3JSONP%E5%B9%B6%E6%8B%93%E5%B1%95/">传送门</a>。</p>
<h4 id="1-jsonp-的跨域流程"><a href="#1-jsonp-的跨域流程" class="headerlink" title="(1)jsonp 的跨域流程"></a><strong>(1)jsonp 的跨域流程</strong></h4><p><strong>直接通过下面的例子来说明 JSONP 实现跨域的流程：</strong></p>
<p>1.定义一个 回调函数 handleResponse 用来接收返回的数据</p>
<pre><code class="hljs">function handleResponse(data) &#123;
    console.log(data);
&#125;;
</code></pre>
<p>2.动态创建一个 script 标签，并且告诉后端回调函数名叫 handleResponse</p>
<pre><code class="hljs">var body = document.getElementsByTagName(&#39;body&#39;)[0];
var script = document.gerElement(&#39;script&#39;);
script.src = &#39;http://K0rz3n.com/json?callback=handleResponse&#39;;
body.appendChild(script);
</code></pre>
<p>3.通过 script.src 请求 <code>http://www.K0rz3n.com/json?callback=handleResponse</code>，<br>4.后端能够识别这样的 URL 格式并处理该请求，然后返回 <code>handleResponse(&#123;&quot;name&quot;: &quot;K0rz3n&quot;&#125;)</code> 给浏览器<br>5.浏览器在接收到 <code>handleResponse(&#123;&quot;name&quot;: &quot;K0rz3n&quot;&#125;)</code> 之后立即执行 ，也就是执行 handleResponse 方法，获得后端返回的数据，这样就完成一次跨域请求了。</p>
<h4 id="2-优缺点对比"><a href="#2-优缺点对比" class="headerlink" title="(2)优缺点对比"></a><strong>(2)优缺点对比</strong></h4><p><strong>优点</strong></p>
<p>1.用于实现跟踪用户点击页面或动态广告曝光次数有较大的优势。</p>
<p><strong>缺点</strong></p>
<p>1.<strong>只支持 GET 请求(这个是比较大的一个限制条件)</strong>。<br>2.只能浏览器与服务器的单向通信，因为浏览器不能访问服务器的响应文本。</p>
<h3 id="3-img-src-跨域"><a href="#3-img-src-跨域" class="headerlink" title="3.img src 跨域"></a><strong>3.img src 跨域</strong></h3><p>由于 img 标签不受浏览器同源策略的影响，允许跨域引用资源。因此可以通过 img 标签的 src 属性进行跨域，这也就是 img src 跨域的基本原理。</p>
<h4 id="1-img-src-的跨域流程"><a href="#1-img-src-的跨域流程" class="headerlink" title="(1)img src 的跨域流程"></a><strong>(1)img src 的跨域流程</strong></h4><p><strong>直接通过下面的例子来说明图像 Ping 实现跨域的流程：</strong></p>
<pre><code class="hljs">var img = new Image();

//通过 onload 及 onerror 事件可以知道响应是什么时候接收到的，但是不能获取响应文本

img.onload = img.onerror = function() &#123;
    console.log(&quot;Done!&quot;);
&#125;

//请求数据通过查询字符串形式发送

img.src = &#39;http://www.K0rz3n.com/test?name=K0rz3n&#39;;
</code></pre>
<h4 id="2-优缺点对比-1"><a href="#2-优缺点对比-1" class="headerlink" title="(2)优缺点对比"></a><strong>(2)优缺点对比</strong></h4><p><strong>优点</strong></p>
<p>1.用于实现跟踪用户点击页面或动态广告曝光次数有较大的优势。</p>
<p><strong>缺点</strong></p>
<p>1.只支持 GET 请求。<br>2.只能浏览器与服务器的单向通信，因为浏览器不能访问服务器的响应文本。</p>
<h3 id="4-Webserver-Proxy-跨域"><a href="#4-Webserver-Proxy-跨域" class="headerlink" title="4.Webserver Proxy 跨域"></a><strong>4.Webserver Proxy 跨域</strong></h3><p>浏览器有跨域限制，但是服务器不存在跨域问题，所以可以由服务器请求所要域的资源再返回给客户端。</p>
<p>服务器代理是万能的。</p>
<h3 id="5-document-domain-跨域"><a href="#5-document-domain-跨域" class="headerlink" title="5.document.domain 跨域"></a><strong>5.document.domain 跨域</strong></h3><h4 id="1-document-domain-的跨域流程"><a href="#1-document-domain-的跨域流程" class="headerlink" title="(1)document.domain 的跨域流程"></a><strong>(1)document.domain 的跨域流程</strong></h4><p><strong>对于主域名相同，而子域名不同的情况，可以使用 document.domain 来跨域。这种方式非常适用于 iframe 跨域的情况。</strong></p>
<p>比如，有一个页面，它的地址是 <a target="_blank" rel="noopener" href="http://www.k0rz3n.com,在这个页面里面有一个/">http://www.K0rz3n.com，在这个页面里面有一个</a> iframe，它的 src 是 <a target="_blank" rel="noopener" href="http://k0rz3n.com/b.html%E3%80%82%E5%BE%88%E6%98%BE%E7%84%B6%EF%BC%8C%E8%BF%99%E4%B8%AA%E9%A1%B5%E9%9D%A2%E4%B8%8E%E5%AE%83%E9%87%8C%E9%9D%A2%E7%9A%84">http://K0rz3n.com/b.html。很显然，这个页面与它里面的</a> iframe 框架是不同域的，所以我们是无法通过在页面中书写 js 代码来获取 iframe 中的东西的。</p>
<p>这个时候，document.domain 就可以派上用场了，我们只要把 <a target="_blank" rel="noopener" href="http://www.k0rz3n.com/a.html">http://www.K0rz3n.com/a.html</a> 和 <a target="_blank" rel="noopener" href="http://www.k0rz3n.com/b.html">http://www.K0rz3n.com/b.html</a> 这两个页面的 document.domain 都设成相同的域名就可以了。但要注意的是，document.domain 的设置是有限制的，我们只能把 document.domain 设置成<strong>自身或更高一级的父域，且主域必须相同</strong>。例如：a.b.K0rz3n.com 中某个文档的 document.domain 可以设成 a.b.K0rz3n.com、b.K0rz3n.com 、K0rz3n.com 中的任意一个，但是不可以设成 c.a.b.K0rz3n.com ，因为这是当前域的子域，也不可以设成 baidu.com，因为主域已经不相同了。</p>
<h4 id="2-document-domain-跨域的具体实现"><a href="#2-document-domain-跨域的具体实现" class="headerlink" title="(2)document.domain 跨域的具体实现"></a><strong>(2)document.domain 跨域的具体实现</strong></h4><p>例如，在页面 <a target="_blank" rel="noopener" href="http://www.k0rz3n.com/a.html">http://www.K0rz3n.com/a.html</a> 中设置document.domain：</p>
<pre><code class="hljs">&lt;iframe src=&quot;http://www.K0rz3n.com/b.html&quot; id=&quot;myIframe&quot; onload=&quot;test()&quot;&gt;
&lt;script&gt;
    document.domain = &#39;K0rz3n.com&#39;; // 设置成主域
    function test() &#123;
        console.log(document.getElementById(&#39;myIframe&#39;).contentWindow);
    &#125;
&lt;/script&gt;
</code></pre>
<p>在页面 <a target="_blank" rel="noopener" href="http://k0rz3n.com/b.html">http://K0rz3n.com/b.html</a> 中也设置 document.domain，而且这也是必须的，虽然这个文档的 domain 就是 K0rz3n.com，但是还是必须显式地设置 document.domain 的值：</p>
<pre><code class="hljs">&lt;script&gt;
    document.domain = &#39;K0rz3n.com&#39;; // document.domain 设置成与主页面相同
&lt;/script&gt;
</code></pre>
<p>这样，<a target="_blank" rel="noopener" href="http://www.k0rz3n.com/a.html">http://www.K0rz3n.com/a.html</a> 就可以通过 js 访问到 <a target="_blank" rel="noopener" href="http://k0rz3n.com/b.html">http://K0rz3n.com/b.html</a> 中的各种属性和对象了。</p>
<h3 id="6-window-name-跨域"><a href="#6-window-name-跨域" class="headerlink" title="6.window.name 跨域"></a><strong>6.window.name 跨域</strong></h3><h4 id="1-window-name-的跨域流程"><a href="#1-window-name-的跨域流程" class="headerlink" title="(1) window.name 的跨域流程"></a><strong>(1) window.name 的跨域流程</strong></h4><p>window 对象有个 name 属性，该属性有个特征：即在一个窗口（window）的生命周期内，窗口载入的所有的页面（不管是相同域的页面还是不同域的页面）都是共享一个 window.name 的，每个页面对 window.name 都有读写的权限，window.name 是持久存在一个窗口载入过的所有页面中的，并不会因新页面的载入而进行重置。</p>
<h4 id="2-window-name-跨域的具体实现"><a href="#2-window-name-跨域的具体实现" class="headerlink" title="(2) window.name 跨域的具体实现"></a><strong>(2) window.name 跨域的具体实现</strong></h4><p>通过下面的例子介绍如何通过 window.name 来跨域获取数据的。</p>
<p><strong>页面 <a target="_blank" rel="noopener" href="http://www.k0rz3n.com/a.html">http://www.K0rz3n.com/a.html</a> 的代码：</strong></p>
<pre><code class="hljs">&lt;iframe src=&quot;http://K0rz3n.com/b.html&quot; id=&quot;myIframe&quot; onload=&quot;test()&quot; style=&quot;display: none;&quot;&gt;

&lt;script&gt;
    function test() &#123;//iframe载入 &quot;http://K0rz3n.com/b.html 页面后会执行该函数
        var iframe = document.getElementById(&#39;myIframe&#39;);
        
    //重置 iframe 的 onload 事件程序，此时经过后面代码重置 src 之后，http://www.K0rz3n.com/a.html 
    //页面与该 iframe 在同一个源了，可以相互访问了
    
        iframe.onload = function() &#123;
            var data = iframe.contentWindow.name; // 获取 iframe 里的 window.name
            console.log(data); // hello world!
        &#125;;
        
    //重置一个与 http://www.K0rz3n.com/a.html 页面同源的页面
    
        iframe.src = &#39;http://www.K0rz3n.com/c.html&#39;;
    &#125;
&lt;/script&gt;
</code></pre>
<p><strong>页面 <a target="_blank" rel="noopener" href="http://k0rz3n.com/b.html">http://K0rz3n.com/b.html</a> 的代码：</strong></p>
<pre><code class="hljs">&lt;script type=&quot;text/javascript&quot;&gt;
    // 给当前的 window.name 设置一个 http://www.K0rz3n.com/a.html 页面想要得到的数据值 
    window.name = &quot;hello world!&quot;;
&lt;/script&gt;
</code></pre>
<h3 id="7-location-hash-跨域"><a href="#7-location-hash-跨域" class="headerlink" title="7.location.hash 跨域"></a><strong>7.location.hash 跨域</strong></h3><h4 id="1-location-hash-跨域的流程"><a href="#1-location-hash-跨域的流程" class="headerlink" title="(1)location.hash 跨域的流程"></a><strong>(1)location.hash 跨域的流程</strong></h4><p>location.hash 方式跨域，是子框架具有修改父框架 src 的 hash 值，通过这个属性进行传递数据，且更改 hash 值，页面不会刷新。<strong>但是传递的数据的字节数是有限的。</strong></p>
<h4 id="2-location-hash-跨域的具体实现"><a href="#2-location-hash-跨域的具体实现" class="headerlink" title="(2)location.hash 跨域的具体实现"></a><strong>(2)location.hash 跨域的具体实现</strong></h4><p><strong>页面 <a target="_blank" rel="noopener" href="http://www.k0rz3n.com/a.html">http://www.K0rz3n.com/a.html</a> 的代码：</strong></p>
<pre><code class="hljs">&lt;iframe src=&quot;http://K0rz3n.com/b.html&quot; id=&quot;myIframe&quot; onload=&quot;test()&quot; style=&quot;display: none;&quot;&gt;
&lt;script&gt;
    // iframe载入 &quot;http://K0rz3n.com/b.html 页面后会执行该函数
    function test() &#123;
        //获取通过 http://K0rz3n.com/b.html 页面设置 hash 值
        var data = window.location.hash;
        console.log(data);
    &#125;
&lt;/script&gt;
</code></pre>
<p><strong>页面 <a target="_blank" rel="noopener" href="http://k0rz3n.com/b.html">http://K0rz3n.com/b.html</a> 的代码：</strong></p>
<pre><code class="hljs">&lt;script type=&quot;text/javascript&quot;&gt;
    //设置父页面的 hash 值
    parent.location.hash = &quot;world&quot;;
&lt;/script&gt;
</code></pre>
<h3 id="8-postMessage-跨域"><a href="#8-postMessage-跨域" class="headerlink" title="8.postMessage 跨域"></a><strong>8.postMessage 跨域</strong></h3><h4 id="1-postMessage-跨域的流程"><a href="#1-postMessage-跨域的流程" class="headerlink" title="(1)postMessage 跨域的流程"></a><strong>(1)postMessage 跨域的流程</strong></h4><p>window.postMessage(message，targetOrigin) 方法是 HTML5 新引进的特性，可以使用它来向其它的 window 对象发送消息，无论这个 window 对象是属于同源或不同源。这个应该就是以后解决 dom 跨域通用方法了。</p>
<p>调用 postMessage 方法的 window 对象是指要接收消息的那一个 window 对象，该方法的第一个参数 message 为要发送的消息，类型只能为字符串；第二个参数 targetOrigin 用来限定接收消息的那个 window 对象所在的域，如果不想限定域，可以使用通配符 *。</p>
<p>需要接收消息的 window 对象，可以通过监听自身的 message 事件来获取传过来的消息，消息内容储存在该事件对象的 data 属性中。</p>
<h4 id="2-postMessage-跨域的具体实现"><a href="#2-postMessage-跨域的具体实现" class="headerlink" title="(2)postMessage 跨域的具体实现"></a><strong>(2)postMessage 跨域的具体实现</strong></h4><p><strong>页面 <a target="_blank" rel="noopener" href="http://www.k0rz3n.com/a.html">http://www.K0rz3n.com/a.html</a> 的代码：</strong></p>
<pre><code class="hljs">&lt;iframe src=&quot;http://K0rz3n.com/b.html&quot; id=&quot;myIframe&quot; onload=&quot;test()&quot; style=&quot;display: none;&quot;&gt;
&lt;script&gt;
    //iframe载入 &quot;http://K0rz3n.com/b.html 页面后会执行该函数
    function test() &#123;
        // 获取 http://K0rz3n.com/b.html 页面的 window 对象，
        // 然后通过 postMessage 向 http://K0rz3n.com/b.html 页面发送消息
        var iframe = document.getElementById(&#39;myIframe&#39;);
        var win = iframe.contentWindow;
        win.postMessage(&#39;我是来自 http://www.K0rz3n.com/a.html 页面的消息&#39;, &#39;*&#39;);
    &#125;
&lt;/script&gt;
</code></pre>
<p><strong>页面 <a target="_blank" rel="noopener" href="http://k0rz3n.com/b.html">http://K0rz3n.com/b.html</a> 的代码：</strong></p>
<pre><code class="hljs">&lt;script type=&quot;text/javascript&quot;&gt;
    // 注册 message 事件用来接收消息
    window.onmessage = function(e) &#123;
        e = e || event; // 获取事件对象
        console.log(e.data); // 通过 data 属性得到发送来的消息
    &#125;
&lt;/script&gt;
</code></pre>
<h2 id="0X03-cookie-的路径和作用域"><a href="#0X03-cookie-的路径和作用域" class="headerlink" title="0X03 cookie 的路径和作用域"></a><strong>0X03 cookie 的路径和作用域</strong></h2><h3 id="1-cookie-的路径"><a href="#1-cookie-的路径" class="headerlink" title="1.cookie 的路径"></a><strong>1.cookie 的路径</strong></h3><p>Cookie 的路径是在服务器创建Cookie 时设置的，它的作用是决定浏览器访问服务器的某个资源时，<br>需要将浏览器端保存的哪些Cookie 归还给服务器</p>
<p><strong>如图所示：</strong></p>
<p><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A54.png" srcset="/img/loading.gif" lazyload alt="此处输入图片的描述"></p>
<p>如上图所示，浏览器端保存的Cookie 有三个，分别是Cookie1、Cookie2 和Cookie3。</p>
<p>它们三个的访问路径分别为：</p>
<pre><code class="hljs">/Example/cookie
/Example/
/Example1/cookie
</code></pre>
<p>浏览器访问服务器端的路径为：</p>
<pre><code class="hljs">http://localhost:8080/Example/cookie/a/index.jsp
</code></pre>
<p>也就是说index.jsp 页面的访问路径为：</p>
<pre><code class="hljs">/Example/cookie/a/
</code></pre>
<p>该路径包含了Cookie1 和Cookie2 的路径，因此在访问index.jsp 时，浏览器会将Cookie1 和Cookie2<br>发送给服务器(简单的说就是父路径给子路径)。这就是Cookie 的路径的作用，其中涉及到访问路径。</p>
<p><strong>如果服务器创建Cookie 时没有设置路径，那么该Cookie 的路径是当前资源的访问路径。</strong></p>
<p>例如：在index.jsp 页面中创建了一个Cookie，index.jsp 页面的访问路径为“&#x2F;Example&#x2F;“，那么该Cookie 的路径就是 &#x2F;Example&#x2F;。如果服务器创建Cookie 时设置了路径，那么Cookie 的路径就是设置的路径，例如：<br>cookie.setPath(“&#x2F;Example&#x2F;cookie”)，那么该Cookie 的路径就是&#x2F;Example&#x2F;cookie。</p>
<h3 id="2-cookie-的作用域"><a href="#2-cookie-的作用域" class="headerlink" title="2.cookie 的作用域"></a><strong>2.cookie 的作用域</strong></h3><p>Cookie 还有一个属性就是域，Cookie 类中有设置和获取cookie 域的方法，如下所示：</p>
<p>(1)Void setDomain(String pattern)：设置cookie 的域；<br>(2)String getDomain()：获取cookie 的域，返回值的类型是String 类型。</p>
<p>一般我们很少使用cookie 的域，只有在多个二级域共享Cookie时才用。例如：<a target="_blank" rel="noopener" href="http://www.baidu.com、zhidao.baidu.com、news.baidu.com、tieba.baidu.com/">www.baidu.com、zhidao.baidu.com、news.baidu.com、tieba.baidu.com</a> 这些域可以理解是百度的子项目，现在要<strong>在这些域中共享cookie</strong>，就需要使用cookie 的域.</p>
<p><strong>使用时需要注意以下两点：</strong></p>
<p>(1)设置domain 为：setDomain(“.baidu.com”)；<br>(2)设置path 为：setPath(“&#x2F;”)。</p>
<h2 id="0X04脚本源的归属问题"><a href="#0X04脚本源的归属问题" class="headerlink" title="0X04脚本源的归属问题"></a><strong>0X04脚本源的归属问题</strong></h2><p>关于脚本源的归属问题是这样规定的，脚本的源是由它所嵌入的页面决定的，也就是说，如果 利用 xss 漏洞向某个页面注入了 js 代码，那么这段 js 代码就是属于这个网站所属的源的，就能对这个网站的内容进行操作，比如说读取 dom 的内容等，这是非常危险的，因为浏览器没有能力去鉴别这段代码是不是网站所有者自己写进网页的，于是就引出了 CSP 这个东西.</p>
<h2 id="0X05-CSP"><a href="#0X05-CSP" class="headerlink" title="0X05 CSP"></a><strong>0X05 CSP</strong></h2><p>一个 编写 CSP 的网站 <a target="_blank" rel="noopener" href="https://www.cspisawesome.com/">https://www.cspisawesome.com/</a></p>
<h3 id="1-什么是CSP"><a href="#1-什么是CSP" class="headerlink" title="1.什么是CSP"></a><strong>1.什么是CSP</strong></h3><p>全称：Content Security Policy 内容安全策略,管理员可以定义多种策略的范围，<strong>这些策略可以被任意组合，不一定要实现全部</strong></p>
<p>CSP定义了Content-Security-Policy HTTP头来允许你创建一个<strong>可信来源的白名单</strong>，使得浏览器只执行和渲染来自这些来源的资源，而不是盲目信任服务器提供的所有内容。即使攻击者可以找到漏洞来注入脚本，但是因为来源不包含在白名单里，因此将不会被执行。</p>
<h3 id="2-CSP-包含哪些内容"><a href="#2-CSP-包含哪些内容" class="headerlink" title="2.CSP 包含哪些内容"></a><strong>2.CSP 包含哪些内容</strong></h3><h4 id="1-内容源"><a href="#1-内容源" class="headerlink" title="(1)内容源"></a><strong>(1)内容源</strong></h4><p>大多数的策略指令都需要一个或者多个内容源，这些内容源指明内容应该从什么地方加载</p>
<h4 id="2-源列表"><a href="#2-源列表" class="headerlink" title="(2)源列表"></a><strong>(2)源列表</strong></h4><p>指定主机 主机可以使用 通配符，主机与主机之间使用空格分割</p>
<h4 id="3-关键字"><a href="#3-关键字" class="headerlink" title="(3)关键字"></a><strong>(3)关键字</strong></h4><p>关键字用来描述某些特别的内容源</p>
<p>1.’none’ :不匹配任何的URL，两侧的单引号必须</p>
<p>2.’self’ :与文档同源 </p>
<p>3.’unsafe-inline’ :允许使用内联资源，包括内联的<code>&lt;script&gt;</code> 内联的 javascript:URL 内联的事件处理函数 onerror 和内联的<code>&lt;style&gt;</code></p>
<p>4.’unsafe-eval’:允许通过字符串创建代码的方式</p>
<blockquote>
<p><strong>注意：</strong> unsafe-inline 和 unsafe-eval 都是不安全的，他会使网站有跨站脚本的风险</p>
</blockquote>
<h4 id="4-数据"><a href="#4-数据" class="headerlink" title="(4)数据"></a><strong>(4)数据</strong></h4><p>data:允许使用 data:URL 是不安全的</p>
<p>mediatream:将 mediastream:URL 作为内容源</p>
<p><strong>两个实例：</strong></p>
<pre><code class="hljs">Content-Security-Policy: default-src &#39;self&#39; trustedscripts.foo.com
Content-Security-Policy: default-src &#39;self&#39;; img-src &#39;self&#39; data:; media-src mediastream:
</code></pre>
<h4 id="5-指令"><a href="#5-指令" class="headerlink" title="(5)指令"></a><strong>(5)指令</strong></h4><p><strong>1.base-uri</strong><br>base-uri 指令定义了 URI，它可以作为文档的基准 URL。如果没有指定值，那么任何 URI 都被允许。如果没有指定这条指令，浏览器会使用 base 元素中的 URL。</p>
<pre><code class="hljs">base-uri source-list
</code></pre>
<p><strong>2.child-src</strong></p>
<p>child-src 指定定义了 web workers 以及嵌套的浏览上下文（如 <code>&lt;frame&gt;</code> 和 <code>&lt;iframe&gt;</code> ）的源。</p>
<pre><code class="hljs">child-src source-list
</code></pre>
<p><strong>3.connect-src</strong></p>
<p>connect-src 指令定义了请求、XMLHttpRequest、WebSocket 和 EventSource 的连接来源。</p>
<pre><code class="hljs">connect-src source-list
</code></pre>
<p><strong>4.default-src</strong></p>
<p>default-src 指令定义了那些没有被更精确指令指定的（默认）安全策略。该指令包含了以下指令：</p>
<pre><code class="hljs">child-src
connect-src
font-src
img-src
media-src
object-src
script-src
style-src

default-src source-list
</code></pre>
<p><strong>5.img-src</strong></p>
<p>img-src指令指定图像和图标的有效来源。</p>
<pre><code class="hljs">img-src source-list
</code></pre>
<p><strong>6.script-src</strong></p>
<p>script-src指令指定JavaScript的有效源。当包含script-src或default-src指令时，除非分别指定“unsafe-inline”和“unsafe-eval”，否则内联脚本和eval()将被禁用。</p>
<p><strong>7.style-src</strong></p>
<p>style-src指令指定样式表的有效来源。这包括外部加载的样式表和<code>&lt;style&gt;</code>元素和HTML样式属性的内联使用。来自源列表中不包含的源的样式表不会被请求或加载。当包含style-src或default-src指令时，<code>&lt;style&gt;</code>元素和HTML样式属性的内联使用将被禁用，除非您指定’unsafe-inline’。</p>
<p><strong>8.object-src</strong></p>
<p>object-src指令为<code>&lt;object&gt;</code>，<code> &lt;embed&gt;</code>，<code> &lt;applet&gt;</code>元素指定有效的源。</p>
<pre><code class="hljs">object-src source-list
</code></pre>
<h2 id="0X06-总结"><a href="#0X06-总结" class="headerlink" title="0X06 总结"></a><strong>0X06 总结</strong></h2><p>这篇文章主要是对一些前端或者浏览器中涉及到和 “源” 有关的一些东西的罗列和整理吧，很多东西来源于网络，夹杂了一些我个人的理解，全当做后期的备忘来用吧</p>
<h2 id="0X07-参考"><a href="#0X07-参考" class="headerlink" title="0X07 参考"></a><strong>0X07 参考</strong></h2><p><a target="_blank" rel="noopener" href="https://yq.aliyun.com/ziliao/317883">https://yq.aliyun.com/ziliao/317883</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy">https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/shimiso/article/details/21830313">https://blog.csdn.net/shimiso/article/details/21830313</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/wonking666/article/details/79159180">https://blog.csdn.net/wonking666/article/details/79159180</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/renpingsheng/p/7688134.html">https://www.cnblogs.com/renpingsheng/p/7688134.html</a><br><a target="_blank" rel="noopener" href="https://www.w3.org/Security/wiki/Same_Origin_Policy">https://www.w3.org/Security/wiki/Same_Origin_Policy</a><br><a target="_blank" rel="noopener" href="https://w3c.github.io/webappsec-csp/">https://w3c.github.io/webappsec-csp/</a><br><a target="_blank" rel="noopener" href="https://security.stackexchange.com/questions/8264/why-is-the-same-origin-policy-so-important">https://security.stackexchange.com/questions/8264/why-is-the-same-origin-policy-so-important</a><br><a target="_blank" rel="noopener" href="https://security.stackexchange.com/questions/91165/why-is-the-synchronizer-token-pattern-preferred-over-the-origin-header-check-to">https://security.stackexchange.com/questions/91165/why-is-the-synchronizer-token-pattern-preferred-over-the-origin-header-check-to</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP</a><br><a target="_blank" rel="noopener" href="https://lorexxar.cn/2016/08/08/ccsp/">https://lorexxar.cn/2016/08/08/ccsp/</a><br><a target="_blank" rel="noopener" href="https://lorexxar.cn/2018/04/05/0ctf2018-blog/">https://lorexxar.cn/2018/04/05/0ctf2018-blog/</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/laixiangran/p/9064769.html">https://www.cnblogs.com/laixiangran/p/9064769.html</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%A4%87%E5%BF%98/" class="category-chain-item">备忘</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%89%8D%E7%AB%AF/" class="print-no-link">#前端</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>浅谈前端“源”相关</div>
      <div>http://example.com/2019/02/09/浅谈前端“源”相关/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>February 9, 2019</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - Non-commercial">
                    <i class="iconfont icon-cc-nc"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="SA - Share-alike">
                    <i class="iconfont icon-cc-sa"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2019/02/10/PHP%20%E4%B8%AD%E7%9A%84%E8%BD%AC%E4%B9%89%E5%87%BD%E6%95%B0%E5%B0%8F%E7%BB%93/" title="PHP 中的转义函数小结">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">PHP 中的转义函数小结</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2019/02/07/%E4%B8%9A%E5%8A%A1%20Web%20%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E5%BE%A1%E7%9A%84%E6%80%9D%E8%80%83/" title="业务 Web 漏洞攻击与防御的思考">
                        <span class="hidden-mobile">业务 Web 漏洞攻击与防御的思考</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
